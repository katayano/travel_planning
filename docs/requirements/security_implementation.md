# Issue #9 セキュリティ対策の実装 - タスク分割

## 概要
ログイン機能のセキュリティ対策を実装し、アプリケーション全体のセキュリティレベルを向上させる。

## タスク分割

### タスク1: パスワード入力フィールドのセキュリティ強化
**状況**: 既に実装済み
- ✅ `type="password"`でマスク表示実装済み
- ✅ `autoComplete="current-password"`設定済み
- ✅ 適切なaria属性設定済み

**追加対応**:
- パスワード表示/非表示切り替え機能の検討（任意）

### タスク2: CSRF対策の実装・確認
**現状**:
- Next.js Server Actionsは内部的にCSRF保護有り
- 明示的なCSRFトークン設定は不要

**実装内容**:
- Next.jsのCSRF保護機能の確認
- セキュリティヘッダーでCSRF関連設定追加
- フォームでのCSRF保護確認

### タスク3: XSS対策の確認・実装
**実装内容**:
- `dangerouslySetInnerHTML`使用箇所の調査（使用禁止）
- 入力値のサニタイゼーション実装
- エスケープ処理の確認
- Content Security Policy (CSP) の設定

### タスク4: セキュリティヘッダーの設定
**実装内容**:
- `next.config.ts`にセキュリティヘッダー追加
  - Content Security Policy (CSP)
  - X-Frame-Options
  - X-Content-Type-Options
  - Referrer-Policy
  - Permissions-Policy

### タスク5: 環境変数の適切な管理
**実装内容**:
- `.env.local`ファイルの作成
- 環境変数の適切な分類
  - パブリック変数: `NEXT_PUBLIC_`プレフィックス
  - プライベート変数: プレフィックスなし
- `.env.example`ファイルの作成

### タスク6: APIルートの認証・認可強化
**実装内容**:
- 認証が必要なAPIルートの確認
- 適切な認証チェック実装
- レート制限の検討
- APIレスポンスのセキュリティ確認

### タスク7: 入力値のバリデーション・サニタイゼーション
**実装内容**:
- zod等のバリデーションライブラリ導入検討
- Server Actionでの入力値検証強化
- SQLインジェクション対策（Prisma使用で基本対応済み）
- HTMLエスケープ処理

## 受け入れ基準チェックリスト

### 必須項目
- [x] パスワード入力フィールドが適切にマスクされている
- [ ] CSRF対策が実装されている
- [ ] XSS対策として dangerouslySetInnerHTML が避けられている
- [ ] 入力値のサニタイゼーションが実装されている
- [ ] セキュリティヘッダーが適切に設定されている
- [ ] 環境変数が適切に管理されている（NEXT_PUBLIC_プレフィックス使用）
- [ ] APIルートで適切な認証・認可が実装されている

### 追加検討項目
- [ ] レート制限の実装
- [ ] セッション管理のセキュリティ
- [ ] ログイン試行回数制限
- [ ] セキュリティログの実装

## 実装順序
1. セキュリティヘッダーの設定（即座に効果）
2. 環境変数の整理（基盤整備）
3. XSS対策の確認・強化（重要度高）
4. 入力値バリデーション強化（データ保護）
5. APIルート認証強化（システム保護）
6. 追加セキュリティ機能（必要に応じて）

## 関連ファイル
- `next.config.ts` - セキュリティヘッダー設定
- `.env.local` - 環境変数（新規作成）
- `src/lib/actions/login.ts` - Server Action セキュリティ
- `src/components/features/login/LoginForm.tsx` - フロントエンド セキュリティ
- `src/middleware.ts` - ミドルウェア セキュリティ
